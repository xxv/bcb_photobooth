<!doctype html>
<html>
    <head>
        <script src="js/jquery-1.7.2.js"></script>
        <script src="js/raphael.js"></script>
        <script>
            var gdata = {io:{handleScriptLoaded:function(data){callback(data)}}},
                talks = {
                    sat: {
                        '9'  : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (regi/breakfast)
                        '10' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (plenary/intro)
                        '12' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '13' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '14' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '15' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (lunch)
                        '16' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '17' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '18' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '19' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '20' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '21' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '22' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (afterparty)
                        '23' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '} //event-wide (end of day 1)
                    },
                    sun : {
                        '9'  : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (regi/breakfast)
                        '10' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '11' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '12' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '13' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '14' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '15' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (lunch)
                        '16' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '17' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '18' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '},
                        '19' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '}, //event-wide (Closing Session)
                        '20' : {'B':' ','C':' ','D':' ','E':' ','F':' ','G':' ','H':' ','I':' ','J':' '} //event-wide (Doors close)
                    }
                },
                isSat = true,
                rooms = {
                    'B': 'horace-mann',
                    'C': 'thomas-paul',
                    'D': 'deborah-sampson',
                    'E': 'abigail-adams',
                    'F': 'crispus-attacks',
                    'G': 'area-1220',
                    'H': 'area-1235',
                    'I': 'area-1255',
                    'J': '11th-floor'
                };


            function callback(data) {
                function processCell(talk) {
                    var c = splitCellName(talk.title.$t);
                    if (c) {
                        talks[(isSat ? 'sat' : 'sun')][c[1]][c[0]] = talk.content.$t
                    }
                }
                
                function splitCellName(title) {
                    var col = title[0],
                        row = title.substring(1)
                    if ((rooms[col]) && (talks[(isSat ? 'sat' : 'sun')][row])) {
                        return [col, row]
                    } else {
                        return false
                    }
                }

                var cells = data.feed.entry;

                for (var x=0, len=cells.length; x < len; x++) {
                    processCell(cells[x])
                }
                // If saturday, load sunday
                if (isSat) {
                    $("head").append('<script src="https://spreadsheets.google.com/feeds/cells/0AiPSd498xaohdGMzdzJNcnF5eE9zV3Q1UFp6T0t5c1E/od5/public/basic?alt=json-in-script"><\/script>')
                    isSat = false
                }
            }

            $(function() {
                var tip = $("#tip").hide(),
                    tipText = "",
                    over = false;

                function addTalksToTooltip(dayNum) {
                    var day = dayNum.substring(0,3),
                        num = dayNum.substring(3);
                    for (var talk in talks[day][num]) {
                        (function() {
                            var room = '#'+rooms[talk];
                            var text = talks[day][num][talk]
                            $(room+' p').html(text)
                        })()
                    }
                    makeTooltips();
                }
                        
                function makeTooltips() {
                    var current = null;
                    for (var state in map) {
                        map[state].color = Raphael.getColor();
                        (function (st, state) {
                            st[0].style.cursor = "pointer";
                            var stateID = '#'+state;
                            var stateContent = $(stateID).html();
                            $(st[0]).mouseover(function(){
                                map[state].animate({fill: "#666", stroke: "#000"}, 500) ;
                                document.getElementById(state).style.display = "";
                                st.animate({fill: st.color, stroke: "#000"}, 500);
                                st.toFront();
                                R.safari();
                                tipText = stateContent;
                                $(tip).stop(true, true).fadeIn();
                                over = true;
                            }).mouseout(function(){
                                st.animate({fill: "#666", stroke: "#000"}, 500);
                                st.toFront();
                                R.safari();
                                $(tip).stop(true, true).fadeOut();
                                over = false;
                            });
                        })(map[state], state);
                    }
                    $(document).mousemove(function(e){
                        if (over){
                            $(tip).css("left", e.clientX+20).css("top", e.clientY+20);
                            $(tip).html(tipText);
                        }
                    });
                }

                var R = Raphael("paper", 900, 600), //set height and width of svg
                    attr_bg = {
                        fill: "#333",
                        stroke: "#000",
                        "stroke-width": 1,
                        "stroke-linejoin": "round"
                    },
                    attr_empty = {
                        fill: "#000",
                        stroke: "#000",
                        "stroke-width": 1,
                        "stroke-linejoin": "round"
                    },
                    attr = {
                        fill: "#666",
                        stroke: "#000",
                        "stroke-width": 1,
                        "stroke-linejoin": "round"
                    },
                    map_background = {
                        'background'           : R.path("M 220.8 135.7 L 445.2 135.7 L 445.2 85.3 L 588.9 85.3 L 588.9 135.1 L 678.4 135.1 L 678.4 85.3 L 823.3 85.3 L 823.3 135.1 L 823.3 201 L 605.1 201 L 458.3 474.6 L 130.6 287.4Z").attr(attr_bg),
                        'empty_zone'           : R.path("M 477 367.6 L 565.9 201 L 458.3 201 L 458.3 367.6Z").attr(attr_empty),
                    },
                    map = {
                        'deborah-sampson' : R.path("M 347.6 273.1 L 256.2 273.1 L 256.2 314.8 L 347.6 367.6Z").attr(attr),
                        'horace-mann'     : R.path("M 348.9 201.6 L 458.3 201.6 L 458.3 367.6 L 347.6 367.6Z").attr(attr),
                        'thomas-paul'     : R.path("M 348.2 201.6 L 256.2 201.6 L 256.2 273.7 L 347.6 273.7Z").attr(attr),
                        'abigail-adams'   : R.path("M 678.4 85.3 L 678.4 135.1 L 750.9 135.1 L 750.9 85.3Z").attr(attr),
                        'crispus-attacks' : R.path("M 750.3 84.7 L 750.3 135.1 L 823.3 135.1 L 823.3 85.3Z").attr(attr),
                        'area-1220'       : R.path("M 590.8 84.1 L 590.8 135.1 L 445.2 135.1 L 445.2 85.3Z").attr(attr),
                        'area-1235'       : R.path("M 194 286.8 L 210.2 239.5 L 256.2 239.5 L 256.2 314.8Z").attr(attr),
                        'area-1255'       : R.path("M 407.3 367.6 L 407.3 407.4 L 445.2 419.9 L 477 367.6Z").attr(attr),
                        '11th-floor'      : R.circle(20,20,10).attr(attr)
                    };
                $('#nav-select').change(function() { 
                    addTalksToTooltip(this.value) 
                })
                // DO current datetime calc here
                addTalksToTooltip($('#nav-select').val());

            })


        </script>
        <!--<script src="https://spreadsheets.google.com/feeds/cells/0AiPSd498xaohdGMzdzJNcnF5eE9zV3Q1UFp6T0t5c1E/od5/public/basic?alt=json-in-script">
            //Sunday
        </script>-->
        <script src="https://spreadsheets.google.com/feeds/cells/0AiPSd498xaohdGMzdzJNcnF5eE9zV3Q1UFp6T0t5c1E/od6/public/basic?alt=json-in-script">
            //Saturday
        </script>
        <style>
            body {
                font-family: Verdana, sans;
            }
            #canvas {
                height: 600px;
                position: relative;
                width: 900px;
                float: left;
            }
            #paper {
                height: 600px;
                position: relative;
                width: 900px;
                display:block;
            }
            .tip-body {
                display: none;
                height: 400px;
            }
            h2, p {
                text-align: center;
            }
            #tip{
                overflow: auto;
                position: absolute;
                right: 0;
                top: 0;
                width: 300px;

                position : absolute;
                /* border : 1px solid gray; */
                background-color : #efefef;
                color:#333;
                padding : 3px;
                z-index: 1000;
                /* set this to create word wrap */
                max-width: 200px;
            }
        </style>
    </head>
    <body>
        <div id="canvas">
            <div id="paper"></div>
            <div id="tip"></div>
            <div id="horace-mann" class="tip-body">
                <h2>Horace Mann</h2>
                <p>
                </p>
            </div>
            <div id="thomas-paul" class="tip-body">
                <h2>Thomas Paul</h2>
                <p>
                </p>
            </div>
            <div id="deborah-sampson" class="tip-body">
                <h2>Deborah Sampson</h2>
                <p>
                </p>
            </div>
            <div id="abigail-adams" class="tip-body">
                <h2>Abigail Adams</h2>
                <p>
                </p>
            </div>
            <div id="crispus-attacks" class="tip-body">
                <h2>Crispus Attacks</h2>
                <p>
                </p>
            </div>
            <div id="area-1220" class="tip-body">
                <h2>Area 1220</h2>
                <p>
                </p>
            </div>
            <div id="area-1235" class="tip-body">
                <h2>Area 1235</h2>
                <p>
                </p>
            </div>
            <div id="area-1255" class="tip-body">
                <h2>Area 1255</h2>
                <p>
                </p>
            </div>
            <div id="11th-floor" class="tip-body">
                <h2>11th Floor</h2>
                <p>
                </p>
            </div>
        </div>
        <p id="copy">Ohai</p>

        <div id="nav">
            <select id="nav-select">
                <optgroup label="sat">
                    <option value="sat9">9:00</option>
                    <option value="sat10">10:00</option>
                    <option value="sat12">11:00</option>
                    <option value="sat13">11:40</option>
                    <option value="sat14">12:20</option>
                    <option value="sat15">1:00</option>
                    <option value="sat16">2:00</option>
                    <option value="sat17">2:40</option>
                    <option value="sat18">3:20</option>
                    <option value="sat19">4:00</option>
                    <option value="sat20">4:40</option>
                    <option value="sat21">5:20</option>
                    <option value="sat22">6:00</option>
                    <option value="sat23">9:00</option>
                </optgroup>
                <optgroup label="sun">
                    <option value="sun9">9:00</option>
                    <option value="sun10">10:00</option>
                    <option value="sun11">10:40</option>
                    <option value="sun12">11:20</option>
                    <option value="sun13">12:00</option>
                    <option value="sun14">12:30</option>
                    <option value="sun15">1:00</option>
                    <option value="sun16">2:00</option>
                    <option value="sun17">2:40</option>
                    <option value="sun18">3:20</option>
                    <option value="sun19">4:00</option>
                    <option value="sun20">5:00</option>
                </optgroup>
            </select>
        </div>
    </body>
</html>
